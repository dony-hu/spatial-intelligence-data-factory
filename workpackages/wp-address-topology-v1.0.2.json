{
  "workpackage_id": "wp-address-topology-v1.0.2",
  "version": "1.0.2",
  "factory_release": {
    "process_version": "process-v1.0.2",
    "tool_bundle_version": "tools-v1.0.2",
    "engine_version": "engine-v1.0.2",
    "released_at": "2026-02-14T14:50:00",
    "released_by": "factory-workpackage-line",
    "rollback_target_version": "1.0.1",
    "runtime_record_ref": "sqlite://database/agent_runtime.db#wp-address-topology-v1.0.2"
  },
  "line_spec": {
    "line_type": "address_to_topology",
    "goal": "基于单条地址输入产出拓扑节点与关系，并回传失败回放证据",
    "constraints": [
      "产线不得修改工艺与工具内核",
      "质量阈值>=0.95",
      "失败需输出步骤级错误信息",
      "失败队列与回放结果必须可追溯",
      "算法口径固定为 parse->normalize->validate->topology_build",
      "规则口径固定为 quality_score>=0.95 判定成功，否则进入失败回放链路"
    ]
  },
  "input_contract": {
    "type": "object",
    "required": ["raw_address"],
    "properties": {
      "raw_address": {"type": "string", "minLength": 3},
      "task_id": {"type": "string"}
    }
  },
  "output_contract": {
    "type": "object",
    "required": ["standard_address", "topology_nodes", "topology_edges", "quality_score"],
    "properties": {
      "standard_address": {"type": "string"},
      "topology_nodes": {"type": "array"},
      "topology_edges": {"type": "array"},
      "quality_score": {"type": "number"},
      "execution_trace_id": {"type": "string"},
      "failure_queue_snapshot_ref": {"type": "string"},
      "replay_result_ref": {"type": "string"}
    }
  },
  "process_spec": {
    "steps": [
      {"code": "parse", "name": "地址解析"},
      {"code": "normalize", "name": "地址标准化"},
      {"code": "validate", "name": "质量校验"},
      {"code": "topology_build", "name": "拓扑构建"}
    ]
  },
  "tool_bundle": {
    "tools": [
      "tools/address_governance.py::AddressParser",
      "tools/address_governance.py::AddressStandardizer",
      "tools/spatial_entity_graph.py::SpatialEntityGraph"
    ]
  },
  "engine_bundle": {
    "runtime": "factory_engine",
    "entrypoint": "tools/factory_workflow.py",
    "mode": "single_record",
    "compatibility": {
      "min_engine_version": "1.0.0",
      "max_engine_version": "1.1.x"
    }
  },
  "observability_bundle": {
    "generator": "factory_observability_generator",
    "entrypoints": [
      "workpackages/bundles/address-topology-v1.0.2/observability/line_observe.py",
      "workpackages/bundles/address-topology-v1.0.2/observability/line_metrics.json"
    ]
  },
  "line_feedback_contract": {
    "required_fields": ["status", "failure_queue_snapshot_ref", "replay_result_ref"],
    "failure_queue_snapshot_ref": "pg://address_line.failure_queue",
    "replay_result_ref": "pg://address_line.replay_runs"
  },
  "rollback": {
    "from_version": "1.0.2",
    "fallback_version": "1.0.1",
    "instructions": [
      "停止新任务注入",
      "切换到 wp-address-topology-v1.0.1",
      "重放失败队列并比对质量结果"
    ]
  }
}
