<svg xmlns="http://www.w3.org/2000/svg" width="2200" height="1480" viewBox="0 0 2200 1480">
  <defs>
    <style>
      .title { font: 700 28px 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif; fill: #0f172a; }
      .subtitle { font: 600 15px 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif; fill: #334155; }
      .group { fill: #f8fafc; stroke: #94a3b8; stroke-width: 2; rx: 14; ry: 14; }
      .group-title { font: 700 18px 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif; fill: #0f172a; }
      .node { fill: #ffffff; stroke: #334155; stroke-width: 1.4; rx: 8; ry: 8; }
      .node-view { fill: #ecfeff; stroke: #0891b2; stroke-width: 1.4; rx: 8; ry: 8; }
      .node-text { font: 12px 'Consolas', 'Menlo', monospace; fill: #111827; }
      .arrow { stroke: #475569; stroke-width: 1.8; fill: none; marker-end: url(#arrowhead); }
      .note { font: 12px 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif; fill: #b91c1c; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="8" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#475569" />
    </marker>
  </defs>

  <rect x="0" y="0" width="2200" height="1480" fill="#f1f5f9"/>
  <text x="40" y="46" class="title">System Data Architecture (PG-Only, Unified DB)</text>
  <text x="40" y="72" class="subtitle">Database: si_factory | Key Schemas: public, address_line, control_plane, trust_meta, trust_db</text>

  <!-- address_line schema -->
  <rect x="40" y="100" width="2120" height="430" class="group"/>
  <text x="60" y="132" class="group-title">Schema: address_line (merged address governance line)</text>

  <rect x="70" y="160" width="250" height="42" class="node-view"/><text x="82" y="186" class="node-text">batch (view -&gt; public.addr_batch)</text>
  <rect x="340" y="160" width="280" height="42" class="node-view"/><text x="352" y="186" class="node-text">raw_input (view -&gt; public.addr_raw)</text>
  <rect x="640" y="160" width="320" height="42" class="node-view"/><text x="652" y="186" class="node-text">standardized (view -&gt; public.addr_canonical)</text>
  <rect x="980" y="160" width="260" height="42" class="node-view"/><text x="992" y="186" class="node-text">review (view -&gt; public.addr_review)</text>

  <rect x="1260" y="160" width="280" height="42" class="node-view"/><text x="1272" y="186" class="node-text">ruleset (view -&gt; public.addr_ruleset)</text>
  <rect x="1560" y="160" width="330" height="42" class="node-view"/><text x="1572" y="186" class="node-text">change_request (view -&gt; public.addr_change_request)</text>
  <rect x="1910" y="160" width="230" height="42" class="node-view"/><text x="1922" y="186" class="node-text">task_run (view)</text>

  <rect x="70" y="220" width="250" height="42" class="node-view"/><text x="82" y="246" class="node-text">audit_event (view)</text>
  <rect x="340" y="220" width="260" height="42" class="node-view"/><text x="352" y="246" class="node-text">api_audit_log (view)</text>
  <rect x="620" y="220" width="320" height="42" class="node-view"/><text x="632" y="246" class="node-text">agent_execution_log (view)</text>

  <rect x="70" y="285" width="260" height="42" class="node"/><text x="82" y="311" class="node-text">address_component</text>
  <rect x="350" y="285" width="320" height="42" class="node"/><text x="362" y="311" class="node-text">address_standardization_rule</text>
  <rect x="690" y="285" width="300" height="42" class="node"/><text x="702" y="311" class="node-text">address_entity_mapping</text>
  <rect x="1010" y="285" width="330" height="42" class="node"/><text x="1022" y="311" class="node-text">entity_multi_source_fusion</text>

  <rect x="1360" y="285" width="280" height="42" class="node"/><text x="1372" y="311" class="node-text">address_quality_metrics</text>
  <rect x="1660" y="285" width="300" height="42" class="node"/><text x="1672" y="311" class="node-text">address_library_version</text>

  <line x1="320" y1="181" x2="340" y2="181" class="arrow"/>
  <line x1="620" y1="181" x2="640" y2="181" class="arrow"/>
  <line x1="960" y1="181" x2="980" y2="181" class="arrow"/>
  <line x1="1540" y1="181" x2="1560" y2="181" class="arrow"/>

  <!-- control_plane schema -->
  <rect x="40" y="560" width="2120" height="360" class="group"/>
  <text x="60" y="592" class="group-title">Schema: control_plane (runtime control plane, independent)</text>

  <rect x="70" y="620" width="160" height="38" class="node"/><text x="82" y="644" class="node-text">process_definition</text>
  <rect x="250" y="620" width="150" height="38" class="node"/><text x="262" y="644" class="node-text">process_version</text>
  <rect x="420" y="620" width="120" height="38" class="node"/><text x="432" y="644" class="node-text">process_step</text>
  <rect x="560" y="620" width="120" height="38" class="node"/><text x="572" y="644" class="node-text">process_gate</text>

  <rect x="700" y="620" width="100" height="38" class="node"/><text x="712" y="644" class="node-text">task_run</text>
  <rect x="820" y="620" width="100" height="38" class="node"/><text x="832" y="644" class="node-text">task_input</text>
  <rect x="940" y="620" width="130" height="38" class="node"/><text x="952" y="644" class="node-text">task_step_run</text>
  <rect x="1090" y="620" width="140" height="38" class="node"/><text x="1102" y="644" class="node-text">task_output_json</text>
  <rect x="1250" y="620" width="120" height="38" class="node"/><text x="1262" y="644" class="node-text">task_state</text>

  <rect x="70" y="680" width="130" height="38" class="node"/><text x="82" y="704" class="node-text">process_draft</text>
  <rect x="220" y="680" width="150" height="38" class="node"/><text x="232" y="704" class="node-text">process_chat_turn</text>
  <rect x="390" y="680" width="170" height="38" class="node"/><text x="402" y="704" class="node-text">draft_version_history</text>
  <rect x="580" y="680" width="150" height="38" class="node"/><text x="592" y="704" class="node-text">draft_comparison</text>

  <rect x="750" y="680" width="160" height="38" class="node"/><text x="762" y="704" class="node-text">confirmation_record</text>
  <rect x="930" y="680" width="140" height="38" class="node"/><text x="942" y="704" class="node-text">operation_audit</text>
  <rect x="1090" y="680" width="140" height="38" class="node"/><text x="1102" y="704" class="node-text">evidence_records</text>
  <rect x="1250" y="680" width="130" height="38" class="node"/><text x="1262" y="704" class="node-text">api_call_log</text>

  <rect x="1400" y="680" width="190" height="38" class="node"/><text x="1412" y="704" class="node-text">api_capability_registry</text>
  <rect x="1610" y="680" width="160" height="38" class="node"/><text x="1622" y="704" class="node-text">external_api_cache</text>
  <rect x="1790" y="680" width="130" height="38" class="node"/><text x="1802" y="704" class="node-text">parsing_event</text>
  <rect x="1940" y="680" width="160" height="38" class="node"/><text x="1952" y="704" class="node-text">schema_registry</text>

  <line x1="230" y1="639" x2="250" y2="639" class="arrow"/>
  <line x1="400" y1="639" x2="420" y2="639" class="arrow"/>
  <line x1="400" y1="639" x2="560" y2="639" class="arrow"/>
  <line x1="800" y1="639" x2="820" y2="639" class="arrow"/>
  <line x1="920" y1="639" x2="940" y2="639" class="arrow"/>
  <line x1="1070" y1="639" x2="1090" y2="639" class="arrow"/>

  <!-- public + trust -->
  <rect x="40" y="950" width="2120" height="490" class="group"/>
  <text x="60" y="982" class="group-title">Other Schemas in Same DB</text>

  <rect x="70" y="1010" width="980" height="390" class="group"/>
  <text x="90" y="1040" class="group-title">Schema: public (factory + governance base + line feedback)</text>
  <rect x="90" y="1060" width="140" height="38" class="node"/><text x="102" y="1084" class="node-text">factory_products</text>
  <rect x="250" y="1060" width="150" height="38" class="node"/><text x="262" y="1084" class="node-text">factory_processes</text>
  <rect x="420" y="1060" width="140" height="38" class="node"/><text x="432" y="1084" class="node-text">production_lines</text>
  <rect x="580" y="1060" width="100" height="38" class="node"/><text x="592" y="1084" class="node-text">workers</text>
  <rect x="700" y="1060" width="110" height="38" class="node"/><text x="712" y="1084" class="node-text">work_orders</text>
  <rect x="830" y="1060" width="120" height="38" class="node"/><text x="842" y="1084" class="node-text">quality_checks</text>

  <rect x="90" y="1120" width="130" height="38" class="node"/><text x="102" y="1144" class="node-text">graph_nodes</text>
  <rect x="240" y="1120" width="170" height="38" class="node"/><text x="252" y="1144" class="node-text">graph_relationships</text>
  <rect x="430" y="1120" width="120" height="38" class="node"/><text x="442" y="1144" class="node-text">failure_queue</text>
  <rect x="570" y="1120" width="100" height="38" class="node"/><text x="582" y="1144" class="node-text">replay_runs</text>

  <rect x="90" y="1180" width="100" height="38" class="node"/><text x="102" y="1204" class="node-text">addr_batch</text>
  <rect x="210" y="1180" width="100" height="38" class="node"/><text x="222" y="1204" class="node-text">addr_raw</text>
  <rect x="330" y="1180" width="120" height="38" class="node"/><text x="342" y="1204" class="node-text">addr_canonical</text>
  <rect x="470" y="1180" width="130" height="38" class="node"/><text x="482" y="1204" class="node-text">addr_review</text>
  <rect x="620" y="1180" width="130" height="38" class="node"/><text x="632" y="1204" class="node-text">addr_ruleset</text>
  <rect x="770" y="1180" width="160" height="38" class="node"/><text x="782" y="1204" class="node-text">addr_change_request</text>

  <rect x="1090" y="1010" width="1070" height="390" class="group"/>
  <text x="1110" y="1040" class="group-title">Schemas: trust_meta + trust_db</text>

  <rect x="1120" y="1060" width="180" height="38" class="node"/><text x="1132" y="1084" class="node-text">trust_meta.source_registry</text>
  <rect x="1320" y="1060" width="180" height="38" class="node"/><text x="1332" y="1084" class="node-text">trust_meta.source_schedule</text>
  <rect x="1520" y="1060" width="180" height="38" class="node"/><text x="1532" y="1084" class="node-text">trust_meta.source_snapshot</text>
  <rect x="1720" y="1060" width="200" height="38" class="node"/><text x="1732" y="1084" class="node-text">trust_meta.snapshot_quality</text>
  <rect x="1940" y="1060" width="190" height="38" class="node"/><text x="1952" y="1084" class="node-text">trust_meta.snapshot_diff</text>

  <rect x="1120" y="1120" width="170" height="38" class="node"/><text x="1132" y="1144" class="node-text">trust_meta.active_release</text>
  <rect x="1310" y="1120" width="160" height="38" class="node"/><text x="1322" y="1144" class="node-text">trust_meta.audit_event</text>
  <rect x="1490" y="1120" width="210" height="38" class="node"/><text x="1502" y="1144" class="node-text">trust_meta.validation_replay</text>

  <rect x="1120" y="1180" width="160" height="38" class="node"/><text x="1132" y="1204" class="node-text">trust_db.admin_division</text>
  <rect x="1300" y="1180" width="170" height="38" class="node"/><text x="1312" y="1204" class="node-text">trust_db.place_name_index</text>
  <rect x="1490" y="1180" width="140" height="38" class="node"/><text x="1502" y="1204" class="node-text">trust_db.road_index</text>
  <rect x="1650" y="1180" width="130" height="38" class="node"/><text x="1662" y="1204" class="node-text">trust_db.poi_index</text>

  <line x1="1300" y1="1079" x2="1320" y2="1079" class="arrow"/>
  <line x1="1500" y1="1079" x2="1520" y2="1079" class="arrow"/>
  <line x1="1700" y1="1079" x2="1720" y2="1079" class="arrow"/>
  <line x1="1700" y1="1079" x2="1940" y2="1079" class="arrow"/>

  <text x="40" y="1460" class="note">Legend: cyan nodes are compatibility views in merged address_line schema; white nodes are physical tables.</text>
</svg>
