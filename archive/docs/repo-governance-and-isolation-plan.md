# 多仓库统一治理与隔离方案

## 1. 目标

在统一管理多个地区项目仓库的同时，严格隔离核心数据工厂仓库，确保：

- 核心仓库只沉淀可复用能力。
- 地区仓库承载本地化定制与交付节奏。
- 通过契约和版本管理实现可控协同。

## 2. 仓库拓扑（推荐）

1. 核心平台仓库（本仓库）
   - `spatial-intelligence-data-factory`
   - 内容：标准、契约、共性能力设计、治理文档、共享脚手架

2. 地区项目仓库（每个地区独立）
   - `project-shanghai-address-governance`
   - `project-kunshan-panorama-3dgs-labeling`
   - `project-wujiang-public-security-governance`
   - `project-beijing-public-security-governance`
   - `project-baoan-city-command`
   - 内容：本地需求、部署配置、定制逻辑、本地数据接入

3. 可选集成仓库（跨仓编排）
   - `si-release-train`（可选）
   - 内容：跨仓版本基线、集成测试编排、发布清单

## 3. 职责边界

核心仓库（平台层）只接收：

- 可被两个及以上地区复用的能力。
- 公共数据契约、服务契约、SDK/模板。
- 跨项目治理规则与质量门禁。

地区仓库（子项目层）承载：

- 地区特有字段、特有流程、特有接口适配。
- 交付期内临时需求与快速验证逻辑。
- 本地运维脚本与部署策略。

## 4. 变更流转机制（关键）

1. 地区提出变更请求（含复用性说明）。
2. 平台评审是否进入核心仓库：
   - 满足复用阈值：进入平台 Backlog。
   - 不满足：留在地区仓库。
3. 平台发布版本后，地区按版本窗口升级接入。
4. 升级后在地区仓库提交验证报告并回传问题。

## 5. 分支与发布策略

核心仓库：

- 分支：`main` + `feature/*` + `release/*` + `hotfix/*`
- 发布：语义化版本（如 `v1.3.0`）
- 要求：所有破坏性变更必须提升主版本并附迁移指南

地区仓库：

- 分支：`main` + `feature/*` + `integration/*`
- 发布：本地版本（可带地区后缀，如 `v2026.02-shanghai.1`）
- 要求：核心能力通过版本依赖接入，不直接拷贝核心代码

## 6. 依赖与同步方式

推荐顺序：

1. 优先 API/服务化依赖（最稳妥）
2. 其次包管理依赖（内部 npm/pypi 等）
3. 最后 Git 子模块（仅在必须共享源码时使用）

不推荐：

- 手工复制核心仓库文件到地区仓库
- 无版本约束地直接引用主干代码

## 7. CI/CD 与质量门禁

核心仓库必须：

- 契约校验（Schema/API）
- Lint/Test/Build
- 兼容性检查（至少一个历史版本回归）

地区仓库必须：

- 接口兼容性检查（对接核心版本）
- 本地场景回归测试
- 升级验证报告（包含回滚结果）

## 8. 权限与安全

- 核心仓库采用更严格写权限（仅平台维护组可直接合并）。
- 地区仓库允许本地团队快速迭代，但关键分支需评审。
- 跨仓访问使用最小权限原则，禁止共享明文凭据。

## 9. 管理节奏（给 Owner）

1. 每周：跨仓状态盘点（版本差异、阻塞、风险）。
2. 每两周：平台版本发布窗口评审。
3. 每月：复用率与分叉率分析（是否出现“私有分叉”扩大）。

## 10. 推荐落地步骤（两周）

1. Week 1：建立地区仓库命名与模板，明确边界清单。
2. Week 1：冻结核心仓库准入规则（复用阈值 + 评审机制）。
3. Week 2：建立版本发布节奏与升级窗口。
4. Week 2：每个地区完成一次“核心版本接入演练”。
