# 技术架构对齐文档 - 空间智能数据工厂（2026-02-11）

## 1. 目标与范围

本文档用于对齐当前项目技术架构，确保以下两点同时成立：

1. 项目定位不变：持续服务多地业务场景交付（上海、昆山、吴江、北京、宝安）。
2. 执行方式升级：引入 Agent 执行内核，提升自动化、可审计、可演进能力。

本文覆盖平台层架构，不包含地区仓本地化实现细节。

## 2. 架构对齐结论（先给结论）

1. 业务能力主线保持“两大业务基座”不变：
- 公安地址治理基座
- 城市调度能力基座

2. 新增“Agent 执行与治理基座”作为平台控制平面，不替代业务基座。

3. 数据底座采用 Lakehouse + DW 双层：
- Lake 负责生长与试错
- DW 负责权威输出与审计

4. 自动化采用“高自动化 + 强审批门禁”模式：
- 自动化覆盖 Profiling、建模草案、DAG 生成、预标注、推理部署、质量监控
- 指标口径、权限合规、生产发布、标签体系、SLA 必须人工审批

## 3. 分层架构

## 3.0 运行态架构图组（部署后）

1. 运行上下文图：`docs/kickoff/assets/runtime-system-context.svg`
2. 部署拓扑图：`docs/kickoff/assets/runtime-deployment-topology.svg`
3. Agent 控制平面运行图：`docs/kickoff/assets/runtime-agent-control-plane.svg`
4. 数据-标注-训练-推理-服务链路图：`docs/kickoff/assets/runtime-data-ml-service-flow.svg`

![运行上下文图](kickoff/assets/runtime-system-context.svg)

![部署拓扑图](kickoff/assets/runtime-deployment-topology.svg)

![Agent 控制平面运行图](kickoff/assets/runtime-agent-control-plane.svg)

![数据-标注-训练-推理-服务链路图](kickoff/assets/runtime-data-ml-service-flow.svg)

## 3.1 L0 平台治理层（Governance）

职责：策略、门禁、审计、版本管理、跨仓协同。

核心组件：
- 审批与发布门禁服务
- 元数据与血缘中心
- 审计日志中心
- 版本管理与发布窗口管理

## 3.2 L1 Agent 控制平面（Control Plane）

职责：目标驱动执行编排、决策循环、工具路由、状态记忆。

Agent 判定标准：
- Goal-Oriented
- Reasoning Loop
- Tool Autonomy
- State and Memory

核心 Agent：
- 需求理解 Agent
- 数据探索 Agent
- 建模 Agent
- 质量 Agent
- 编排 Agent
- 影响分析 Agent
- 执行 Agent
- 审计 Agent
- 推理服务 Agent

## 3.3 L2 业务能力平面（Domain Plane）

两大业务基座：
1. 公安地址治理基座
- 地址标准化、实体映射、质量校验、审计追踪

2. 城市调度能力基座
- 场景策略、语音到调度动作编排、执行反馈闭环

## 3.4 L3 数据与模型平面（Data + ML Plane）

数据链路：
- 多源采集（街景、视频、遥感、IoT、业务库）
- 数据处理（清洗、融合、标准化、特征化）
- 数据资产（明细层、主题层、服务层）

模型链路：
- 标注（预标注+人工校验）
- 训练（Pipeline、评测、版本化）
- 推理（服务化部署、反馈回流）

## 3.5 L4 接入与消费平面（Serving Plane）

- 数据 API
- 推理服务 API
- 指挥调度应用
- 运营看板与专题应用

## 4. 关键流程（端到端）

1. 需求结构化
2. 数据连通与 Profiling
3. 口径/权限/标签/SLA 人审
4. Agent 生成交付包（模型、DAG、规则、服务配置）
5. 发布审批与灰度上线
6. 运行监控与异常处置
7. 效果回流与策略迭代

## 5. 关键技术组件清单

1. 数据基础设施
- 对象存储 + 开放表格式（Lakehouse）
- DW（权威指标与审计输出）
- 元数据与血缘系统

2. 编排与执行
- 工作流引擎（DAG 调度）
- 任务执行网关（含重试/回滚）
- 规则引擎（质量与门禁）

3. Agent 运行时
- 目标管理器
- 推理与策略路由器
- 工具注册中心
- 状态存储与记忆管理

4. MLOps/LLMOps
- 标注任务系统
- 训练流水线
- 模型注册与灰度发布
- 在线推理网关

5. 安全与审计
- 身份鉴权与最小权限
- 数据脱敏与分级访问
- 全链路审计留痕

## 6. 架构门禁与审批点（硬约束）

必须人工审批后执行：
1. 指标口径变更
2. 权限与合规策略变更
3. 生产发布与回滚窗口
4. 标签体系重大调整
5. SLA 与成本策略变更

自动化门禁：
1. 合约校验（Schema/API）
2. 质量门禁（完整性、准确性、时效性）
3. 回归门禁（模型/规则/服务）

## 6.1 人参与角色矩阵（客户 + 丰图）

| 参与角色 | 组织侧 | 主要参与环节 | 决策/签收权限 |
| --- | --- | --- | --- |
| 业务负责人 | 客户 | 目标定义、KPI 口径、业务验收 | 指标口径签收、业务验收结论 |
| 业务专家（标签/规则） | 客户 | 标签体系、难例裁决、规则确认 | 标签与口径裁决 |
| 数据/安全合规负责人 | 客户 | 数据授权、合规审查、权限边界 | 合规放行/驳回 |
| 运维/值守负责人 | 客户 | 发布窗口协调、应急响应协同 | 发布窗口确认、应急升级确认 |
| 项目经理（交付） | 丰图 | 计划推进、里程碑管理、跨方协同 | 里程碑状态确认、风险升级触发 |
| 技术负责人/架构师 | 丰图 | 架构评审、技术方案决策、变更评估 | 架构方案签收、技术变更放行 |
| 数据治理负责人 | 丰图 | 质量规则、血缘、口径一致性治理 | 数据治理规则发布签收 |
| MLOps/模型负责人 | 丰图 | 训练评测、模型发布、回滚策略 | 模型发布/回滚技术决策 |
| 发布负责人（Release Owner） | 丰图 | 生产发布、灰度、回滚执行 | 发布执行签发与回滚触发 |
| 审计与质控负责人 | 丰图 | 审计留痕、证据归档、复盘闭环 | 审计结论确认、整改闭环验收 |

## 6.2 必须“客户+丰图双确认”的关键节点

1. KPI 与指标口径冻结
2. 数据权限与合规边界放行
3. 生产发布窗口与变更范围确认
4. 重大模型/规则变更上线
5. 事故回滚与恢复结论

## 7. 核心接口与契约

1. 数据契约
- 字段定义、质量规则、口径版本、兼容策略

2. 服务契约
- API 协议、SLA、错误码、幂等与限流

3. 审计契约
- 审批动作、责任人、时间戳、执行上下文

## 8. 非功能要求（NFR）

1. 可用性：关键服务高可用，支持灰度与快速回滚
2. 可观测性：日志、指标、链路追踪全覆盖
3. 可扩展性：支持多地区并行接入与场景扩展
4. 可审计性：全链路追溯到任务、版本、审批动作
5. 安全性：最小权限、脱敏策略、密钥治理

## 9. 分阶段落地路线（架构视角）

1. R1：两大业务基座 MVP
- 地址治理最小链路 + 城市调度最小链路

2. R2：Agent 执行与治理基座 MVP
- 目标编排、工具路由、状态记忆、审批联动

3. R3：统一可观测与审计
- 质量、执行、审批、服务统一监控

4. R4：多地区并行接入
- 核心版本窗口化发布，子仓分批接入

## 10. 对齐后的实施边界

平台层负责：
- 共性能力、契约、治理与门禁

子项目层负责：
- 本地化流程、部署与业务适配

禁止事项：
- 未经评审将地区定制直接并入平台层
- 绕过审批门禁直接触发关键自动执行

## 11. 待评审项（请在架构评审会确认）

1. Agent 运行时技术选型与部署形态（集中式/分布式）
2. 状态与记忆存储方案（一致性与成本平衡）
3. 推理服务网关的 SLA 分层策略
4. 门禁规则的统一 DSL 或策略配置格式
