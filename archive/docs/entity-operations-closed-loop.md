# 实体发现与运营闭环设计

## 目标

当各类接入数据清洗后发现引用的空间实体在库中不存在时，自动触发实体运营流程，实现“自动核验 -> 人工确认 -> 现场核实 -> 入库回写”的闭环。

## 触发条件

1. 关联失败：地址/名称/坐标无法匹配到现有 `space_entity_id`。
2. 低置信度：最佳匹配分低于阈值（例如 `< 0.75`）。
3. 高冲突：候选实体数量过多且分差过小，无法自动判定。
4. 时态冲突：同名实体历史已失效或状态未知。

## 流程状态机

1. `NEW_CANDIDATE`：新候选实体，待核验。
2. `AUTO_VERIFYING`：系统进行多源自动核验。
3. `NEED_HUMAN_REVIEW`：自动核验未收敛，待人工审核。
4. `NEED_FIELD_TASK`：人工无法判定，触发现场核实。
5. `CONFIRMED_CREATE`：确认新建实体并入库。
6. `CONFIRMED_MERGE`：确认并入已有实体并修正关系。
7. `REJECTED`：确认噪声或无效数据。

## 多源核验策略

### 来源分层

1. 政府公开数据（最高优先级）。
2. 权威互联网地图平台。
3. 主流生活服务平台（例如点评/美团）。
4. 其他公开网站与第三方来源。

### 核验打分因子

1. 名称一致性（全称/别名/简称）。
2. 地址一致性（行政区、道路、门牌）。
3. 空间邻近度（点位距离、落区一致性）。
4. 时间新鲜度（最近更新时间、失效标记）。
5. 来源可信度（权威级别、历史准确率）。

### 输出

- `evidence_pack`：来源链接、抓取时间、截图/摘要、比对结果、建议动作。

## 人工审核与现场任务

### 人工审核

1. 审核界面展示候选实体、证据包、系统建议。
2. 审核动作：新建、合并、驳回、升级现场核实。
3. 所有决策必须带原因码与备注，支持复核追踪。

### 现场核实

1. 任务派发到移动端，采集坐标、照片、门头信息、营业状态。
2. 支持轨迹与时间戳留痕，防止无效回传。
3. 现场结果回写后自动触发最终入库动作。

## 数据模型

1. `entity_candidate`
2. `entity_verification`
3. `entity_review_task`
4. `field_verification_task`
5. `entity_operation_log`

建议字段最小集：

- `id`、`source_record_id`、`candidate_name`、`candidate_address`
- `candidate_geom`、`status`、`confidence`、`decision`
- `decision_reason_code`、`reviewer`、`reviewed_at`
- `evidence_pack_uri`、`created_at`、`updated_at`

## 质量门禁与SLA

1. 自动核验必须输出可审计证据，缺失则不得自动入库。
2. 人工审核任务超时触发告警与升级。
3. 现场任务需定义最大处理时长与重派机制。
4. 入库动作必须记录前后状态和关系变更日志。

## 指标（KPI）

1. 未识别实体自动发现召回率 `>= 90%`。
2. 自动核验后无需人工比例 `>= 60%`（阶段目标）。
3. 人工审核准确率 `>= 95%`。
4. 现场核实任务按时完成率 `>= 90%`。
5. 误创建/误合并率 `<= 1%`。

