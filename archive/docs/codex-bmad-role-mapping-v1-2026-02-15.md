# Codex + BMAD 研发治理角色矩阵（v1）

- 日期：2026-02-15
- 目的：把“BMAD治理角色 + 当前协同工作线角色 + Agent能力域”打通，形成你当前研发阶段可执行的统一派单与验收口径。
- 适用阶段：Implementation（当前在制）

> 说明：
> - 本文只定义“你现在用来研发系统”的角色体系。
> - “项目负责人/需求负责人/技术负责人/交付负责人/数据治理与质检人员”属于未来系统使用方的运营角色体系，不纳入当前研发治理映射。

## 1. 研发治理体系（当前生效）

1) 治理层（RACI，管方向与门禁）
- BMad Master
- 平台PM
- 架构师
- Scrum Master
- 子项目负责人

2) 执行组织层（协同工作线，管日常推进）
- 项目管理总控
- 工程监理
- 核心引擎与运行时
- 产线执行与回传
- 可信数据Hub
- 地址算法与治理规则
- 测试平台与质量门槛
- 可观测与运营指标

3) 能力层（Agent，管自动化能力）
- 需求理解 / 数据探索 / 建模 / 质量 / 编排 / 影响分析 / 执行 / 审计 / 推理服务

---

## 2. 默认映射矩阵（v1，研发阶段）

| 工作线 | 治理责任角色（A） | 工作线执行Owner（R） | 主Agent能力域 | 主要交付物 |
|---|---|---|---|---|
| 项目管理总控 | 平台PM | 项目管理总控线负责人 | 编排 + 审计 | dispatch、overview、管理验收包 |
| 工程监理 | BMad Master | 工程监理线负责人 | 审计 + 影响分析 | 监理审计报告、越界拦截结论 |
| 核心引擎与运行时 | 架构师 | 核心引擎与运行时线负责人 | 执行 + 编排 | runtime能力、API门禁、回归报告 |
| 产线执行与回传 | Scrum Master | 产线执行与回传线负责人 | 执行 + 质量 | line run证据、feedback回传 |
| 可信数据Hub | 架构师 | 可信数据Hub线负责人 | 建模 + 执行 | Hub接口与数据契约实现 |
| 地址算法与治理规则 | 架构师 | 地址算法与治理规则线负责人 | 数据探索 + 建模 + 质量 | 规则版本、算法包、验收报告 |
| 测试平台与质量门槛 | BMad Master | 测试平台与质量门槛线负责人 | 质量 + 审计 | 测试套件、门槛报告、NO_GO依据 |
| 可观测与运营指标 | 平台PM | 可观测与运营指标线负责人 | 编排 + 推理服务 | 指标看板、追踪字段、运营报表 |

说明：
- A=最终负责（Accountable），R=工作线直接执行Owner（Responsible）。
- C/I（咨询/知会）在 v1 先省略，避免首次使用复杂化。

---

## 3. 未来系统使用者角色（单列，不并入研发治理）

以下角色是你系统建成后的业务使用方角色，不是当前研发组织分工：

- 项目负责人（业务负责人）
- 需求负责人（PM/产品）
- 技术负责人（架构/开发）
- 交付负责人（实施/运维）
- 数据治理与质检人员

建议：在后续文档中标注为“运营角色体系（Run-time）”，避免和“研发治理体系（Build-time）”混写。

---

## 4. 为什么之前看起来像三套体系

- 治理层解决“谁拍板、谁背责”。
- 工作线层解决“今天谁推进、谁回写状态”。
- Agent层解决“哪些动作可自动化”。
- 运营角色层解决“系统上线后谁来使用”。

它们不是冲突，而是 Build-time 与 Run-time 的边界没有被显式写出来。

---

## 5. 当前阶段（Implementation）使用规则

每条任务卡必须同时写清：
1. 工作线（执行组织）
2. A角色与R角色（研发治理体系）
3. 主Agent能力域（最多2个）
4. 验收门槛（GO/NO_GO 条件）
5. 证据路径（文件或报告）

推荐模板：
- 任务：<一句话目标>
- 工作线：<8条之一>
- A/R：<治理角色A> / <工作线负责人R>
- Agent能力：<能力1> + <能力2>
- 验收：<可量化门槛>
- 证据：<产物路径>

---

## 6. 明日可直接执行的最小动作

1. 在新的 dispatch 文档里强制补齐 A/R/Agent 三字段。
2. 每条线日更 status 时附一条“主Agent能力是否命中”的自检。
3. 发生跨线冲突时，按 A 角色仲裁，不在执行层拉扯。
4. 所有“未来系统使用者角色”描述统一放到运营文档，不出现在研发派单中。

---

## 7. 版本约束

- 本文是 v1（先跑起来）。
- 当你明确了具体人名后，再升级到 v2（补 C/I 与值班机制）。

---

## 8. 与 BMAD 成熟 Skills 的结合方式（执行版）

你当前仓内可用 skills（`.codex/prompts`）可作为研发流水线节点使用：

- `speckit.specify`：产出/更新需求规格（What/Why）
- `speckit.clarify`：消歧与关键决策冻结
- `speckit.plan`：技术方案与实现计划
- `speckit.tasks`：任务分解（依赖与并行）
- `speckit.implement`：按任务实施
- `speckit.analyze`：一致性分析/回归检查
- `speckit.checklist`：验收清单核对
- `speckit.taskstoissues`：任务到 issue 化

### 8.1 角色-技能绑定原则

1. 治理角色不直接“写代码”，主要绑定决策与门禁类 skills。
2. 工作线执行 Owner 绑定实施类 skills。
3. 每个派单最多指定 1 个主 skill 链，避免同一任务多链并发导致语义漂移。

### 8.2 工作线与主 skill 链映射（默认）

| 工作线 | 主 skill 链（按顺序） | 责任说明 |
|---|---|---|
| 项目管理总控 | `specify -> clarify -> tasks -> checklist` | 冻结范围、派单、验收口径 |
| 工程监理 | `analyze -> checklist` | 边界审计、违规拦截、NO_GO 依据 |
| 核心引擎与运行时 | `plan -> implement -> analyze` | 技术方案、实现、回归一致性 |
| 产线执行与回传 | `tasks -> implement -> analyze` | 执行闭环与证据链产出 |
| 可信数据Hub | `plan -> implement -> analyze` | Hub 能力落地与契约一致性 |
| 地址算法与治理规则 | `specify -> plan -> implement -> analyze` | 规则定义、实现与效果验证 |
| 测试平台与质量门槛 | `tasks -> implement -> checklist` | 测试任务分解、执行与门禁判定 |
| 可观测与运营指标 | `plan -> implement -> checklist` | 指标落盘、看板可视、验收核对 |

### 8.3 派单中的 skills 字段（新增强制）

除既有字段外，派单增加：

- `skill_profile`：工作线默认 skill 链标识（如 `core_runtime_v1`）
- `skill_entry`：本次从哪一步开始（如 `implement`）
- `skill_exit_gate`：结束门禁（如 `checklist_pass` / `analyze_pass`）

推荐写法：

- `skill_profile`: `core_runtime_v1`
- `skill_entry`: `plan`
- `skill_exit_gate`: `analyze_pass`

### 8.4 最小执行闭环（每个任务都要走）

1. `specify/clarify` 冻结范围（可跳过但必须说明理由）
2. `tasks` 形成可执行任务清单
3. `implement` 落地交付
4. `analyze/checklist` 给出 GO/NO_GO
5. 证据回写到 `coordination/status` 与 `output/dashboard` 事件流

### 8.5 失败回退策略

- 若 `analyze` 失败：回退到 `plan` 重估方案，不得直接继续 `implement`。
- 若 `checklist` 失败：保持 `NO_GO`，仅允许补证据或补测试后复核。
- 若跨线冲突：由 `A_role` 仲裁，冲突结论写入状态文件与事件流。
